<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Static Kicks | Pakistan</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <style>
        /* --- VARIABLES --- */
        :root {
            --primary: #121212;
            --accent: #25D366; 
            --bg: #FAFAFA;
            --card-bg: #FFFFFF;
            --text-gray: #757575;
            --shadow-hover: 0 12px 24px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background-color: var(--bg); color: var(--primary); 
            font-family: 'Poppins', sans-serif; padding-top: 70px; 
            display: flex; flex-direction: column; min-height: 100vh;
        }

        /* --- HEADER --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 70px;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(12px);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 5%; z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .logo { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 1.4rem; }
        .logo span { color: var(--text-gray); font-weight: 400; }
        
        .cart-icon { position: relative; font-size: 1.2rem; cursor: pointer; }
        .cart-badge {
            position: absolute; top: -5px; right: -8px; background: var(--primary); color: white;
            font-size: 0.6rem; width: 16px; height: 16px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; font-weight: bold;
        }

        /* --- HERO SECTION --- */
        .hero {
            position: relative; height: 50vh; min-height: 350px;
            background: url('https://images.unsplash.com/photo-1552346154-21d32810aba3?q=80&w=2000&auto=format&fit=crop') center/cover no-repeat;
            display: flex; align-items: center; justify-content: center;
            text-align: center; margin-bottom: 0;
        }
        .hero-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.3)); }
        .hero-content { position: relative; z-index: 1; color: white; padding: 1rem; }
        .hero h1 { font-family: 'Montserrat', sans-serif; font-size: 2.5rem; font-weight: 800; text-transform: uppercase; margin-bottom: 1rem; }
        
        /* --- SEARCH & FILTER PANEL --- */
        .filter-container {
            max-width: 1200px; margin: -30px auto 2rem; padding: 0 5%; position: relative; z-index: 10;
        }
        .search-bar {
            background: white; padding: 1rem; border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); display: flex; gap: 1rem; align-items: center;
        }
        .search-input {
            flex: 1; padding: 12px; border: 1px solid #eee; border-radius: 8px; font-size: 1rem; outline: none;
        }
        .filter-toggle {
            padding: 12px 20px; background: #111; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;
        }
        
        /* Hidden Filter Panel */
        #filter-panel {
            display: none; background: #fff; padding: 1.5rem; margin-top: 10px; border-radius: 12px; border: 1px solid #eee;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }
        .filter-group { margin-bottom: 1.5rem; }
        .filter-label { font-weight: 700; margin-bottom: 0.8rem; display: block; font-size: 0.9rem; }
        .price-inputs { display: flex; gap: 10px; align-items: center; }
        .price-inputs input { width: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; }
        
        .cat-btn {
            padding: 6px 15px; border: 1px solid #ddd; background: white; border-radius: 20px; 
            cursor: pointer; margin-right: 8px; margin-bottom: 8px; font-size: 0.9rem; transition: all 0.2s;
        }
        .cat-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- GRID --- */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 5%; flex: 1; }
        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem; padding-bottom: 4rem;
        }

        /* --- CARD --- */
        .card {
            background: var(--card-bg); border-radius: 12px; transition: transform 0.3s ease; cursor: pointer;
            border: 1px solid transparent;
        }
        .card:hover { transform: translateY(-8px); box-shadow: var(--shadow-hover); }
        .card-img-wrapper {
            height: 260px; width: 100%; background: #f4f4f4; border-radius: 12px; overflow: hidden; position: relative;
        }
        .card-img { width: 100%; height: 100%; object-fit: cover; }
        .badge {
            position: absolute; top: 10px; left: 10px; background: white; color: black; 
            padding: 4px 10px; font-size: 0.7rem; font-weight: 700; border-radius: 4px; text-transform: uppercase;
        }
        .card-details { padding: 1rem 0.5rem; }
        .card-title { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .card-price { font-size: 1.1rem; font-weight: 700; }

        /* --- FOOTER --- */
        footer { background: var(--primary); color: white; padding: 3rem 5%; text-align: center; margin-top: auto; }
        .footer-logo { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 1.5rem; margin-bottom: 1rem; }
        .footer-links a { color: #ccc; text-decoration: none; margin: 0 10px; }

        @media (max-width: 600px) {
            .product-grid { grid-template-columns: 1fr 1fr; gap: 1rem; }
            .card-img-wrapper { height: 180px; }
            .filter-container { margin-top: 0; padding-top: 1rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">STATIC<span>KICKS.</span></div>
        <div class="cart-icon">ðŸ›’ <span class="cart-badge" id="cart-count">0</span></div>
    </header>

    <div class="hero">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1>Find Your Fit</h1>
        </div>
    </div>

    <div class="filter-container">
        <div class="search-bar">
            <input type="text" id="search-input" class="search-input" placeholder="Search shoes (e.g. Nike, Casual)...">
            <button class="filter-toggle" onclick="toggleFilterPanel()">Filters â–¾</button>
        </div>

        <div id="filter-panel">
            <div class="filter-group">
                <span class="filter-label">Category</span>
                <div id="category-container">
                    </div>
            </div>

            <div class="filter-group">
                <span class="filter-label">Price Range (PKR)</span>
                <div class="price-inputs">
                    <input type="number" id="min-price" placeholder="Min">
                    <span>-</span>
                    <input type="number" id="max-price" placeholder="Max">
                </div>
            </div>
            
            <button onclick="applyFilters()" style="width:100%; padding:10px; background:var(--accent); color:white; border:none; border-radius:6px; font-weight:600; cursor:pointer;">Apply Filters</button>
        </div>
    </div>

    <div class="container">
        <div class="product-grid" id="product-list">
            <p style="text-align: center; grid-column: 1/-1;">Loading Inventory...</p>
        </div>
    </div>

    <footer>
        <div class="footer-logo" id="ft-name">STATIC.</div>
        <div style="margin-bottom: 1.5rem;">
            <p id="ft-address" style="color:#aaa; font-size:0.9rem;">Loading Address...</p>
            <p id="ft-phone" style="font-weight:bold; color:white;">...</p>
        </div>
        <div class="footer-links">
            <a id="ft-insta" href="#" target="_blank">Instagram</a> â€¢ <a id="ft-fb" href="#" target="_blank">Facebook</a>
        </div>
        <div style="margin-top:2rem; font-size:0.7rem; opacity:0.5;">&copy; 2025 Static Kicks Pakistan</div>
    </footer>

    <script>
        let allProducts = [];
        let globalSettings = {};
        let activeCategory = 'Men'; // Default logic

        async function initApp() {
            await loadSettings();
            await loadProducts();
        }

        // 1. LOAD SETTINGS
        async function loadSettings() {
            try {
                const res = await fetch('settings.json');
                if(!res.ok) throw new Error();
                globalSettings = await res.json();
                
                if(globalSettings.store_name) document.getElementById('ft-name').innerText = globalSettings.store_name;
                if(globalSettings.address) document.getElementById('ft-address').innerText = globalSettings.address;
                if(globalSettings.display_phone) document.getElementById('ft-phone').innerText = "ðŸ“ž " + globalSettings.display_phone;
                if(globalSettings.instagram) document.getElementById('ft-insta').href = globalSettings.instagram;
                if(globalSettings.facebook) document.getElementById('ft-fb').href = globalSettings.facebook;
            } catch (e) { console.warn("Settings not loaded"); }
        }

        // 2. LOAD PRODUCTS & GENERATE FILTERS
        async function loadProducts() {
            try {
                const res = await fetch('products.json');
                const data = await res.json();
                allProducts = data.shoes;
                
                generateCategories();
                applyFilters(); // Apply initial filter
            } catch (e) {
                document.getElementById('product-list').innerHTML = '<p style="text-align:center; width:100%;">Failed to load products.</p>';
            }
        }

        // 3. GENERATE CATEGORIES
        function generateCategories() {
            // Get unique categories + Default 'Men'
            const cats = ['Men', ...new Set(allProducts.map(p => p.category).filter(Boolean))];
            const uniqueCats = [...new Set(cats)]; // Remove duplicates
            
            const container = document.getElementById('category-container');
            container.innerHTML = `<button class="cat-btn" onclick="setCategory('All', this)">All</button>`; // Add 'All' option

            uniqueCats.forEach(cat => {
                const isActive = cat === 'Men' ? 'active' : '';
                container.innerHTML += `<button class="cat-btn ${isActive}" onclick="setCategory('${cat}', this)">${cat}</button>`;
            });
            
            // Set default active logic
            activeCategory = 'Men';
        }

        // 4. FILTER LOGIC
        function toggleFilterPanel() {
            const panel = document.getElementById('filter-panel');
            panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
        }

        function setCategory(cat, btn) {
            activeCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            applyFilters();
        }

        function applyFilters() {
            const term = document.getElementById('search-input').value.toLowerCase();
            const min = parseInt(document.getElementById('min-price').value) || 0;
            const max = parseInt(document.getElementById('max-price').value) || 999999;

            const filtered = allProducts.filter(p => {
                const matchSearch = p.title.toLowerCase().includes(term);
                const matchPrice = p.price >= min && p.price <= max;
                
                // If Category is 'All', show everything. Else, match category. 
                // Fallback: If product has NO category, show it in 'Men' or 'All'
                const pCat = p.category || 'Men';
                const matchCat = activeCategory === 'All' ? true : pCat === activeCategory;

                return matchSearch && matchPrice && matchCat;
            });

            renderCards(filtered);
        }

        // Listen for Search Enter Key
        document.getElementById('search-input').addEventListener('keyup', applyFilters);

        // 5. RENDER CARDS
        function renderCards(list) {
            const grid = document.getElementById('product-list');
            grid.innerHTML = '';
            
            if(list.length === 0) {
                grid.innerHTML = '<p style="text-align:center; grid-column:1/-1;">No products found.</p>';
                return;
            }

            list.forEach((shoe, i) => {
                // Use the FIRST image if gallery exists
                const img = shoe.gallery ? shoe.gallery[0].image : shoe.image;
                
                grid.innerHTML += `
                    <article class="card" onclick="openProduct('${shoe.title}')" style="animation: fadeIn 0.5s ease forwards; animation-delay: ${i*50}ms; opacity:0;">
                        <div class="card-img-wrapper">
                            <img src="${img}" class="card-img" loading="lazy" alt="${shoe.title}">
                            ${shoe.price < 5000 ? '<span class="badge">Sale</span>' : ''}
                        </div>
                        <div class="card-details">
                            <div style="font-size:0.8rem; color:#888;">${shoe.category || 'Sneaker'}</div>
                            <h3 class="card-title">${shoe.title}</h3>
                            <div class="card-price">PKR ${shoe.price.toLocaleString()}</div>
                        </div>
                    </article>
                `;
            });
        }

        // 6. REDIRECT TO PRODUCT PAGE
        function openProduct(title) {
            window.location.href = `product.html?title=${encodeURIComponent(title)}`;
        }

        // 7. ADMIN REDIRECT
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) window.netlifyIdentity.on("login", () => document.location.href = "/admin/");
            });
        }

        window.onload = initApp;
    </script>
    
    <style>@keyframes fadeIn { to { opacity:1; } }</style>
</body>
</html>