<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>Static Kicks | Pakistan</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <style>
        :root {
            --primary: #121212;
            --accent: #25D366; 
            --bg: #FAFAFA;
            --card-bg: #FFFFFF;
            --text-gray: #757575;
            --shadow-hover: 0 12px 24px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { overflow-x: hidden; width: 100%; }
        body { 
            background-color: var(--bg); color: var(--primary); 
            font-family: 'Poppins', sans-serif; padding-top: 70px; 
            display: flex; flex-direction: column; min-height: 100vh;
        }

        /* --- HEADER --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 70px;
            background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(12px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%; z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05);
            gap: 15px;
        }

        .logo { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 1.4rem; white-space: nowrap; }
        .logo span { color: var(--text-gray); font-weight: 400; }

        /* SEARCH BAR & DROPDOWN */
        .header-search {
            flex: 1; max-width: 400px; position: relative;
        }
        .header-search input {
            width: 100%; padding: 8px 15px; background: #f1f1f1;
            border: 1px solid transparent; border-radius: 50px;
            font-family: 'Poppins', sans-serif; font-size: 0.9rem; outline: none;
            transition: all 0.2s;
        }
        .header-search input:focus { background: #fff; border-color: #ddd; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        /* The Dropdown Container */
        .search-results {
            position: absolute; top: 110%; left: 0; width: 100%;
            background: white; border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            max-height: 300px; overflow-y: auto;
            display: none; flex-direction: column;
            border: 1px solid #eee;
        }
        .search-item {
            display: flex; align-items: center; gap: 10px; padding: 10px;
            border-bottom: 1px solid #f9f9f9; cursor: pointer; transition: 0.2s;
        }
        .search-item:hover { background: #f4f4f4; }
        .search-item img { width: 40px; height: 40px; border-radius: 6px; object-fit: cover; }
        .search-info h4 { font-size: 0.9rem; font-weight: 600; color: #333; }
        .search-info p { font-size: 0.8rem; color: #888; }

        /* HEADER RIGHT */
        .header-right { display: flex; align-items: center; gap: 20px; flex-shrink: 0; }
        .cart-icon { position: relative; font-size: 1.3rem; cursor: pointer; }
        .cart-badge {
            position: absolute; top: -5px; right: -8px; background: var(--primary); color: white;
            font-size: 0.6rem; width: 16px; height: 16px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; font-weight: bold;
        }

        /* --- CART SIDEBAR --- */
        .side-cart {
            position: fixed; top: 0; right: -350px; width: 320px; height: 100vh;
            background: white; box-shadow: -5px 0 30px rgba(0,0,0,0.1);
            z-index: 2000; padding: 20px; transition: right 0.3s ease;
            display: flex; flex-direction: column;
        }
        .side-cart.open { right: 0; }
        
        .cart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .cart-header h3 { font-family: 'Montserrat', sans-serif; font-weight: 700; }
        .close-cart { font-size: 1.5rem; cursor: pointer; }
        
        .cart-items { flex: 1; overflow-y: auto; }
        .cart-item { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid #f5f5f5; padding-bottom: 10px; }
        .cart-item img { width: 50px; height: 50px; border-radius: 5px; object-fit: cover; }
        
        .cart-footer { margin-top: auto; border-top: 1px solid #eee; padding-top: 15px; }
        .checkout-btn {
            width: 100%; background: var(--primary); color: white; padding: 12px;
            border: none; border-radius: 8px; font-weight: 600; cursor: pointer;
        }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.3); z-index: 1500; display: none;
        }
        .overlay.active { display: block; }

        /* --- HERO --- */
        .hero {
            position: relative; height: 40vh; min-height: 300px;
            background: url('https://images.unsplash.com/photo-1552346154-21d32810aba3?q=80&w=2000&auto=format&fit=crop') center/cover no-repeat;
            display: flex; align-items: center; justify-content: center;
            text-align: center; margin-bottom: 2rem;
        }
        .hero-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.2)); }
        .hero-content { position: relative; z-index: 1; color: white; padding: 1rem; }
        .hero h1 { font-family: 'Montserrat', sans-serif; font-size: 2.2rem; font-weight: 800; text-transform: uppercase; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        /* --- GRID --- */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 5%; flex: 1; width: 100%; }
        .section-title {
            font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1.2rem;
            margin-bottom: 1.5rem; border-left: 4px solid var(--primary); padding-left: 10px;
        }
        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem; padding-bottom: 4rem;
        }

        /* --- CARD --- */
        .card {
            background: var(--card-bg); border-radius: 12px; transition: transform 0.3s ease; cursor: pointer;
            border: 1px solid transparent; position: relative;
        }
        .card:hover { transform: translateY(-8px); box-shadow: var(--shadow-hover); }
        .card-img-wrapper { height: 260px; width: 100%; background: #f4f4f4; border-radius: 12px; overflow: hidden; position: relative; }
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .card:hover .card-img { transform: scale(1.05); }
        .badge { position: absolute; top: 10px; left: 10px; background: white; color: black; padding: 5px 12px; font-size: 0.7rem; font-weight: 700; border-radius: 20px; }
        .rating-badge { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #FFD700; padding: 4px 8px; font-size: 0.75rem; border-radius: 6px; font-weight: bold; }
        .card-details { padding: 1rem 0.5rem; }
        .card-title { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .card-price { font-size: 1.1rem; font-weight: 700; }

        /* --- FOOTER --- */
        footer { background: var(--primary); color: white; padding: 3rem 5%; text-align: center; margin-top: auto; }
        .footer-logo { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 1.5rem; margin-bottom: 1rem; }
        .footer-links a { color: #ccc; text-decoration: none; margin: 0 10px; }

        /* MOBILE */
        @media (max-width: 600px) {
            header { padding: 0 15px; }
            .logo { font-size: 1.1rem; }
            .header-search { max-width: 140px; }
            .header-search input { padding: 6px 10px; font-size: 0.8rem; }
            .product-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
            .card-img-wrapper { height: 180px; }
            .side-cart { width: 85%; right: -100%; } 
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">STATIC<span>KICKS.</span></div>
        
        <div class="header-search">
            <input type="text" id="search-input" placeholder="Search shoes..." autocomplete="off">
            <div id="search-results" class="search-results">
                </div>
        </div>

        <div class="header-right">
            <div class="cart-icon" onclick="toggleCart()">ðŸ›’ <span class="cart-badge" id="cart-count">0</span></div>
        </div>
    </header>

    <div class="overlay" id="overlay" onclick="toggleCart()"></div>
    <div class="side-cart" id="side-cart">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <span class="close-cart" onclick="toggleCart()">Ã—</span>
        </div>
        <div class="cart-items" id="cart-items-container">
            <p style="text-align:center; color:#888; margin-top:20px;">Your cart is empty.</p>
        </div>
        <div class="cart-footer">
            <button class="checkout-btn" onclick="goToCheckout()">Proceed to Checkout</button>
        </div>
    </div>

    <div class="hero">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1>Walk With Power</h1>
            <p>Premium Footwear. Exclusive Drops.</p>
        </div>
    </div>

    <div class="container">
        <div class="section-title">Latest Arrivals</div>
        <div class="product-grid" id="product-list">
            <p style="text-align: center; grid-column: 1/-1;">Loading Inventory...</p>
        </div>
    </div>

    <footer>
        <div class="footer-logo" id="ft-name">STATIC.</div>
        <div style="margin-bottom: 1.5rem;">
            <p id="ft-address" style="color:#aaa; font-size:0.9rem;">Loading Address...</p>
            <p id="ft-phone" style="font-weight:bold; color:white;">...</p>
        </div>
        <div class="footer-links">
            <a id="ft-insta" href="#" target="_blank">Instagram</a> â€¢ <a id="ft-fb" href="#" target="_blank">Facebook</a>
        </div>
        <div style="margin-top:2rem; font-size:0.7rem; opacity:0.5;">&copy; 2025 Static Kicks Pakistan</div>
    </footer>

    <script>
        let allProducts = [];
        let globalSettings = {};
        
        // --- CART LOGIC ---
        function getCart() { return JSON.parse(localStorage.getItem('cart') || '[]'); }
        function saveCart(cart) { localStorage.setItem('cart', JSON.stringify(cart)); updateCartUI(); }
        
        function updateCartUI() {
            const cart = getCart();
            document.getElementById('cart-count').innerText = cart.length;
            
            const container = document.getElementById('cart-items-container');
            if (cart.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#888; margin-top:20px;">Your cart is empty.</p>';
            } else {
                container.innerHTML = cart.map((item, index) => `
                    <div class="cart-item">
                        <img src="${item.img}" alt="img">
                        <div style="flex:1;">
                            <div style="font-size:0.9rem; font-weight:600;">${item.title}</div>
                            <div style="font-size:0.8rem; color:green;">PKR ${item.price}</div>
                        </div>
                        <span onclick="removeFromCart(${index})" style="color:red; cursor:pointer;">Ã—</span>
                    </div>
                `).join('');
            }
        }

        function removeFromCart(index) {
            const cart = getCart();
            cart.splice(index, 1);
            saveCart(cart);
        }

        function toggleCart() {
            document.getElementById('side-cart').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('active');
        }

        function goToCheckout() {
            window.location.href = 'checkout.html';
        }

        // --- APP INIT ---
        async function initApp() {
            updateCartUI();
            await loadSettings();
            await loadProducts();
        }

        async function loadSettings() {
            try {
                const res = await fetch('settings.json');
                if(!res.ok) throw new Error();
                globalSettings = await res.json();
                
                if(globalSettings.store_name) document.getElementById('ft-name').innerText = globalSettings.store_name;
                if(globalSettings.address) document.getElementById('ft-address').innerText = globalSettings.address;
                if(globalSettings.display_phone) document.getElementById('ft-phone').innerText = "ðŸ“ž " + globalSettings.display_phone;
                if(globalSettings.instagram) document.getElementById('ft-insta').href = globalSettings.instagram;
                if(globalSettings.facebook) document.getElementById('ft-fb').href = globalSettings.facebook;
            } catch (e) {}
        }

        async function loadProducts() {
            try {
                const res = await fetch('products.json');
                const data = await res.json();
                let products = data.shoes || [];

                // Sort & Shuffle Logic
                const rated = products.filter(p => p.rating && p.rating > 0);
                const unrated = products.filter(p => !p.rating || p.rating <= 0);
                rated.sort((a, b) => b.rating - a.rating);
                for (let i = unrated.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [unrated[i], unrated[j]] = [unrated[j], unrated[i]];
                }
                allProducts = [...rated, ...unrated];
                renderCards(allProducts);
            } catch (e) {
                document.getElementById('product-list').innerHTML = '<p>Failed to load products.</p>';
            }
        }

        function renderCards(list) {
            const grid = document.getElementById('product-list');
            grid.innerHTML = '';
            list.forEach((shoe, i) => {
                const img = shoe.gallery ? shoe.gallery[0].image : shoe.image;
                const ratingBadge = (shoe.rating && shoe.rating > 0) ? `<span class="rating-badge">â˜… ${shoe.rating}</span>` : '';
                grid.innerHTML += `
                    <article class="card" onclick="openProduct('${shoe.title}')" style="opacity:0; animation:fadeIn 0.5s forwards ${i*30}ms;">
                        <div class="card-img-wrapper">
                            <img src="${img}" class="card-img" loading="lazy" alt="${shoe.title}">
                            ${shoe.price < 5000 ? '<span class="badge">Sale</span>' : ''}
                            ${ratingBadge}
                        </div>
                        <div class="card-details">
                            <div style="font-size:0.8rem; color:#888;">${shoe.category || 'Sneaker'}</div>
                            <h3 class="card-title">${shoe.title}</h3>
                            <div class="card-price">PKR ${shoe.price.toLocaleString()}</div>
                        </div>
                    </article>
                `;
            });
        }

        function openProduct(title) {
            window.location.href = `product.html?title=${encodeURIComponent(title)}`;
        }

        // --- SEARCH DROPDOWN LOGIC ---
        const searchInput = document.getElementById('search-input');
        const resultsBox = document.getElementById('search-results');

        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            if(term.length < 1) { resultsBox.style.display = 'none'; return; }

            const matches = allProducts.filter(p => p.title.toLowerCase().includes(term));
            
            if(matches.length > 0) {
                resultsBox.innerHTML = matches.slice(0, 5).map(p => { // Limit to 5 results
                    const img = p.gallery ? p.gallery[0].image : p.image;
                    return `
                        <div class="search-item" onclick="openProduct('${p.title}')">
                            <img src="${img}" alt="thumb">
                            <div class="search-info">
                                <h4>${p.title}</h4>
                                <p>PKR ${p.price}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                resultsBox.style.display = 'flex';
            } else {
                resultsBox.innerHTML = '<div style="padding:10px; color:#888; text-align:center;">No results found</div>';
                resultsBox.style.display = 'flex';
            }
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !resultsBox.contains(e.target)) {
                resultsBox.style.display = 'none';
            }
        });

        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) window.netlifyIdentity.on("login", () => document.location.href = "/admin/");
            });
        }

        window.onload = initApp;
    </script>
    <style>@keyframes fadeIn { to { opacity:1; } }</style>
</body>
</html>