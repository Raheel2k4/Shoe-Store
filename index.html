<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>Static Kicks | Pakistan</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <style>
        /* --- VARIABLES --- */
        :root {
            --primary: #121212;
            --accent: #25D366; 
            --bg: #FAFAFA;
            --card-bg: #FFFFFF;
            --text-gray: #757575;
            --shadow-hover: 0 12px 24px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Prevent horizontal scroll (zoom issue) */
        html, body {
            overflow-x: hidden;
            width: 100%;
        }

        body { 
            background-color: var(--bg); color: var(--primary); 
            font-family: 'Poppins', sans-serif; padding-top: 70px; 
            display: flex; flex-direction: column; min-height: 100vh;
        }

        /* --- HEADER (Redesigned with Search) --- */
        header {
            position: fixed; top: 0; left: 0; width: 100%; height: 70px;
            background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(12px);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%; z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05);
            gap: 15px; /* Spacing between elements */
        }

        .logo { 
            font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 1.4rem; 
            white-space: nowrap; /* Keep logo on one line */
        }
        .logo span { color: var(--text-gray); font-weight: 400; }

        /* New Header Search Bar */
        .header-search {
            flex: 1;
            max-width: 400px; /* Don't get too wide on desktop */
            position: relative;
        }
        
        .header-search input {
            width: 100%;
            padding: 8px 15px;
            background: #f1f1f1;
            border: 1px solid transparent;
            border-radius: 50px;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
            outline: none;
            transition: all 0.2s;
        }
        
        .header-search input:focus {
            background: #fff;
            border-color: #ddd;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .header-right {
            display: flex; align-items: center; gap: 20px;
            flex-shrink: 0; /* Prevent icons from squishing */
        }
        
        .cart-icon { position: relative; font-size: 1.3rem; cursor: pointer; }
        .cart-badge {
            position: absolute; top: -5px; right: -8px; background: var(--primary); color: white;
            font-size: 0.6rem; width: 16px; height: 16px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; font-weight: bold;
        }

        /* --- HERO SECTION --- */
        .hero {
            position: relative; height: 40vh; min-height: 300px;
            background: url('https://images.unsplash.com/photo-1552346154-21d32810aba3?q=80&w=2000&auto=format&fit=crop') center/cover no-repeat;
            display: flex; align-items: center; justify-content: center;
            text-align: center; margin-bottom: 2rem;
        }
        .hero-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.2)); }
        .hero-content { position: relative; z-index: 1; color: white; padding: 1rem; }
        .hero h1 { font-family: 'Montserrat', sans-serif; font-size: 2.2rem; font-weight: 800; text-transform: uppercase; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .hero p { font-size: 1rem; opacity: 0.9; margin-top: 5px; }

        /* --- GRID --- */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 5%; flex: 1; width: 100%; }
        
        .section-title {
            font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 1.2rem;
            margin-bottom: 1.5rem; border-left: 4px solid var(--primary); padding-left: 10px;
        }

        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 2rem; padding-bottom: 4rem;
        }

        /* --- CARD --- */
        .card {
            background: var(--card-bg); border-radius: 12px; transition: transform 0.3s ease; cursor: pointer;
            border: 1px solid transparent; position: relative;
        }
        .card:hover { transform: translateY(-8px); box-shadow: var(--shadow-hover); }
        .card-img-wrapper {
            height: 260px; width: 100%; background: #f4f4f4; border-radius: 12px; overflow: hidden; position: relative;
        }
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .card:hover .card-img { transform: scale(1.05); }

        .badge {
            position: absolute; top: 10px; left: 10px; background: white; color: black; 
            padding: 5px 12px; font-size: 0.7rem; font-weight: 700; border-radius: 20px; text-transform: uppercase;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .rating-badge {
            position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #FFD700;
            padding: 4px 8px; font-size: 0.75rem; border-radius: 6px; font-weight: bold;
            display: flex; align-items: center; gap: 3px;
        }

        .card-details { padding: 1rem 0.5rem; }
        .card-title { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .card-price { font-size: 1.1rem; font-weight: 700; }

        /* --- FOOTER --- */
        footer { background: var(--primary); color: white; padding: 3rem 5%; text-align: center; margin-top: auto; }
        .footer-logo { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 1.5rem; margin-bottom: 1rem; }
        .footer-links a { color: #ccc; text-decoration: none; margin: 0 10px; }

        /* --- MOBILE TWEAKS --- */
        @media (max-width: 600px) {
            header { padding: 0 15px; }
            .logo { font-size: 1.1rem; }
            .header-search { max-width: 140px; } /* Shrink search on mobile */
            .header-search input { padding: 6px 10px; font-size: 0.8rem; }
            
            .hero { height: 30vh; min-height: 250px; }
            .hero h1 { font-size: 1.5rem; }

            .product-grid { grid-template-columns: 1fr 1fr; gap: 10px; } /* Tight grid */
            .card-img-wrapper { height: 180px; }
            .card-details { padding: 0.8rem 0.3rem; }
            .card-title { font-size: 0.9rem; }
            .card-price { font-size: 0.95rem; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">STATIC<span>KICKS.</span></div>
        
        <div class="header-search">
            <input type="text" id="search-input" placeholder="Search shoes..." autocomplete="off">
        </div>

        <div class="header-right">
            <div class="cart-icon">ðŸ›’ <span class="cart-badge" id="cart-count">0</span></div>
        </div>
    </header>

    <div class="hero">
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1>Walk With Power</h1>
            <p>Premium Footwear. Exclusive Drops.</p>
        </div>
    </div>

    <div class="container">
        <div class="section-title">Latest Arrivals</div>
        <div class="product-grid" id="product-list">
            <p style="text-align: center; grid-column: 1/-1;">Loading Inventory...</p>
        </div>
    </div>

    <footer>
        <div class="footer-logo" id="ft-name">STATIC.</div>
        <div style="margin-bottom: 1.5rem;">
            <p id="ft-address" style="color:#aaa; font-size:0.9rem;">Loading Address...</p>
            <p id="ft-phone" style="font-weight:bold; color:white;">...</p>
        </div>
        <div class="footer-links">
            <a id="ft-insta" href="#" target="_blank">Instagram</a> â€¢ <a id="ft-fb" href="#" target="_blank">Facebook</a>
        </div>
        <div style="margin-top:2rem; font-size:0.7rem; opacity:0.5;">&copy; 2025 Static Kicks Pakistan</div>
    </footer>

    <script>
        let allProducts = [];
        let globalSettings = {};

        async function initApp() {
            await loadSettings();
            await loadProducts();
        }

        // 1. LOAD SETTINGS
        async function loadSettings() {
            try {
                const res = await fetch('settings.json');
                if(!res.ok) throw new Error();
                globalSettings = await res.json();
                
                if(globalSettings.store_name) document.getElementById('ft-name').innerText = globalSettings.store_name;
                if(globalSettings.address) document.getElementById('ft-address').innerText = globalSettings.address;
                if(globalSettings.display_phone) document.getElementById('ft-phone').innerText = "ðŸ“ž " + globalSettings.display_phone;
                if(globalSettings.instagram) document.getElementById('ft-insta').href = globalSettings.instagram;
                if(globalSettings.facebook) document.getElementById('ft-fb').href = globalSettings.facebook;
            } catch (e) { console.warn("Settings not loaded"); }
        }

        // 2. LOAD PRODUCTS & SORT LOGIC
        async function loadProducts() {
            try {
                const res = await fetch('products.json');
                const data = await res.json();
                let products = data.shoes || [];

                // --- SORTING LOGIC ---
                // 1. Separate items with a rating vs items without
                const rated = products.filter(p => p.rating && p.rating > 0);
                const unrated = products.filter(p => !p.rating || p.rating <= 0);

                // 2. Sort rated items by highest rating first
                rated.sort((a, b) => b.rating - a.rating);

                // 3. Randomize (Shuffle) the unrated items
                // Fisher-Yates shuffle for true randomness
                for (let i = unrated.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [unrated[i], unrated[j]] = [unrated[j], unrated[i]];
                }

                // 4. Combine: Rated first, then random unrated
                allProducts = [...rated, ...unrated];
                
                renderCards(allProducts);
            } catch (e) {
                console.error(e);
                document.getElementById('product-list').innerHTML = '<p style="text-align:center; width:100%;">Failed to load products.</p>';
            }
        }

        // 3. RENDER CARDS
        function renderCards(list) {
            const grid = document.getElementById('product-list');
            grid.innerHTML = '';
            
            if(list.length === 0) {
                grid.innerHTML = '<p style="text-align:center; grid-column:1/-1;">No products found.</p>';
                return;
            }

            list.forEach((shoe, i) => {
                const img = shoe.gallery ? shoe.gallery[0].image : shoe.image;
                // Check if rating exists for badge display
                const ratingBadge = (shoe.rating && shoe.rating > 0) 
                    ? `<span class="rating-badge">â˜… ${shoe.rating}</span>` 
                    : '';

                grid.innerHTML += `
                    <article class="card" onclick="openProduct('${shoe.title}')" style="animation: fadeIn 0.5s ease forwards; animation-delay: ${i*30}ms; opacity:0;">
                        <div class="card-img-wrapper">
                            <img src="${img}" class="card-img" loading="lazy" alt="${shoe.title}">
                            ${shoe.price < 5000 ? '<span class="badge">Sale</span>' : ''}
                            ${ratingBadge}
                        </div>
                        <div class="card-details">
                            <div style="font-size:0.8rem; color:#888;">${shoe.category || 'Sneaker'}</div>
                            <h3 class="card-title">${shoe.title}</h3>
                            <div class="card-price">PKR ${shoe.price.toLocaleString()}</div>
                        </div>
                    </article>
                `;
            });
        }

        // 4. SEARCH LOGIC (Filters removed, only Search remains)
        document.getElementById('search-input').addEventListener('keyup', (e) => {
            const term = e.target.value.toLowerCase();
            const filtered = allProducts.filter(p => p.title.toLowerCase().includes(term));
            renderCards(filtered);
        });

        // 5. REDIRECT TO PRODUCT PAGE
        function openProduct(title) {
            window.location.href = `product.html?title=${encodeURIComponent(title)}`;
        }

        // 6. ADMIN REDIRECT
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) window.netlifyIdentity.on("login", () => document.location.href = "/admin/");
            });
        }

        window.onload = initApp;
    </script>
    
    <style>@keyframes fadeIn { to { opacity:1; } }</style>
</body>
</html>